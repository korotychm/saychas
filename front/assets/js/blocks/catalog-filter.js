// var filters = {
//   "category_id":"000000006",
//   "rangeprice":{"minprice":"580000","maxprice":"9899100"},
//   "filters":[
//     {
//       "id":"000000001-000000006",
//       "title":"Страна-производитель",
//       "type":"8",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"156",
//           "value":"КИТАЙ"
//         },
//         {
//           "valueCode":"704",
//           "value":"ВЬЕТНАМ"
//         }
//       ]
//     },
//     {
//       "id":"000000003-000000006",
//       "title":"Бренд",
//       "type":"6",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000003",
//           "value":"HUAWEI"
//         },
//         {
//           "valueCode":"000009",
//           "value":"Nokia"
//         },
//         {
//           "valueCode":"000010",
//           "value":"Xiaomi"
//         },
//         {
//           "valueCode":"000018",
//           "value":"Apple"
//         },
//         {
//           "valueCode":"000019",
//           "value":"Samsung"
//         },
//         {
//           "valueCode":"000020",
//           "value":"HUAWEI"
//         },
//         {
//           "valueCode":"000021",
//           "value":"Nokia"
//         },
//         {
//           "valueCode":"000022",
//           "value":"Xiaomi"
//         },
//         {
//           "valueCode":"000023",
//           "value":"Apple"
//         },
//         {
//           "valueCode":"000024",
//           "value":"Samsung"
//         }
//       ]
//     },
//     {
//       "id":"000000004-000000006",
//       "title":"Цвет",
//       "type":"7",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000001",
//           "value":["#0F0F0F","Черный"]
//         },
//         {
//           "valueCode":"000000002",
//           "value":["#7DC7FF","Голубой"]
//         },
//         {
//           "valueCode":"000000004",
//           "value":["#FFFFFF","Белый"]
//         },
//         {
//           "valueCode":"000000005",
//           "value":["#8B00FF","Фиолетовый"]
//         },
//         {
//           "valueCode":"000000006",
//           "value":["#A40404","Темно-красный"]
//         },
//         {
//           "valueCode":"000000007",
//           "value":["#FFAB15","Оранжевый"]
//         },
//         {
//           "valueCode":"000000008",
//           "value":["#966000","Коричневый"]
//         },
//         {
//           "valueCode":"000000009",
//           "value":["#10F4E9","Бирюзовый"]
//         },
//         {
//           "valueCode":"000000010",
//           "value":["#F6F004","Желтый"]
//         },
//         {
//           "valueCode":"000000011",
//           "value":["#960096","Пурпурный"]
//         },
//         {
//           "valueCode":"000000012",
//           "value":["#FA3232","Красный"]
//         },
//         {
//           "valueCode":"000000013",
//           "value":["#018CFF","Синий"]
//         },
//         {
//           "valueCode":"000000015",
//           "value":["#45940A","Темно-зеленый"]
//         },
//         {
//           "valueCode":"000000016",
//           "value":["#6CE70F","Зеленый"]
//         }
//       ]
//     },
//     {
//       "id":"000000014-000000006",
//       "title":"Операционная система",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000011",
//           "value":"Android"
//         },
//         {
//           "valueCode":"000000044",
//           "value":"iOS"
//         }
//       ]
//     },
//     {
//       "id":"000000029-000000006",
//       "title":"Диагональ (дюйм)",
//       "type":"2",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"6.1",
//           "value":"6.1"
//         },
//         {
//           "valueCode":"6.2",
//           "value":"6.2"
//         },
//         {
//           "valueCode":"6.3",
//           "value":"6.3"
//         },
//         {
//           "valueCode":"6.39",
//           "value":"6.39"
//         },
//         {
//           "valueCode":"6.4",
//           "value":"6.4"
//         },
//         {
//           "valueCode":"6.5",
//           "value":"6.5"
//         },
//         {
//           "valueCode":"6.67",
//           "value":"6.67"
//         },
//         {
//           "valueCode":"6.7",
//           "value":"6.7"
//         }
//       ]
//     },
//     {
//       "id":"000000036-000000006",
//       "title":"Разрешение",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000039",
//           "value":"1440x720"
//         },
//         {
//           "valueCode":"000000040",
//           "value":"2400x1080"
//         },
//         {
//           "valueCode":"000000041",
//           "value":"1792x828"
//         },
//         {
//           "valueCode":"000000046",
//           "value":"2532х1170"
//         },
//         {
//           "valueCode":"000000051",
//           "value":"1560x720"
//         }
//       ]
//     },
//     {
//       "id":"000000037-000000006",
//       "title":"Тип дисплея",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000016",
//           "value":"TFT"
//         },
//         {
//           "valueCode":"000000017",
//           "value":"OLED"
//         },
//         {
//           "valueCode":"000000042",
//           "value":"Liquid Retina HD"
//         },
//         {
//           "valueCode":"000000048",
//           "value":"IPS"
//         }
//       ]
//     },
//     {
//       "id":"000000038-000000006",
//       "title":"Защитное покрытие",
//       "type":"3",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"1",
//           "value":"1"
//         }
//       ]
//     },
//     {
//       "id":"000000040-000000006",
//       "title":"Объем встроенной памяти (ГБ)",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000019","value":"16"
//         },
//         {
//           "valueCode":"000000021",
//           "value":"64"
//         },
//         {
//           "valueCode":"000000022",
//           "value":"128"
//         },
//         {
//           "valueCode":"000000045",
//           "value":"256"
//         }
//       ]
//     },
//     {
//       "id":"000000041-000000006",
//       "title":"Объем оперативной памяти (ГБ)",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000023",
//           "value":"8"
//         },
//         {
//           "valueCode":"000000024",
//           "value":"2"
//         },
//         {
//           "valueCode":"000000025",
//           "value":"6"
//         },
//         {
//           "valueCode":"000000047",
//           "value":"4"
//         }
//       ]
//     },
//     {
//       "id":"000000051-000000006",
//       "title":"Количество SIM карт",
//       "type":"4",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"000000034",
//           "value":"1"
//         },
//         {
//           "valueCode":"000000035",
//           "value":"2"
//         }
//       ]
//     },
//     {
//       "id":"000000058-000000006",
//       "title":"Количество Мп основной камеры",
//       "type":"2",
//       "unit":"",
//       "options":[
//         {
//           "valueCode":"12",
//           "value":"12"
//         },
//         {
//           "valueCode":"16",
//           "value":"16"
//         },
//         {
//           "valueCode":"48",
//           "value":"48"
//         },
//         {
//           "valueCode":"64",
//           "value":"64"
//         },
//         {
//           "valueCode":"108",
//           "value":"108"
//         }
//       ]
//     }
//   ]
// };

// set minmax and step to range filters

function isFloat(n) {
    return n === +n && n !== (n|0);
}

$(document).on('input','.range input[type="range"]',function(){
  setRange($(this).parent());
});

$(document).on('change','.tooltip-from',function(){
  let range = $(this).parent().parent().parent().find('.range__left');
  if ($(this).val() != range.val()){
    range.val($(this).val());
  }
  setRange(range.parent());
});

$(document).on('change','.tooltip-to',function(){
  let range = $(this).parent().parent().parent().find('.range__right');
  if ($(this).val() != range.val()){
    range.val($(this).val());
  }
  setRange(range.parent());
});

function setRange(el) {
  let min = +el.find('.range__left').attr('min'),
      max = +el.find('.range__right').attr('max'),
      minVal = +el.find('.range__left').val(),
      maxVal = +el.find('.range__right').val();

  if (minVal < min){
    minVal = min;
    el.find('.range__left').val(minVal);
  }
  if (maxVal > max){
    maxVal = max;
    el.find('.range__right').val(maxVal);
  }

  if (minVal > maxVal){
    minVal = maxVal;
    el.find('.range__left').val(minVal);
    let tmp = maxVal;
    maxVal = minVal;
    minVal = tmp;
    el.find('.range__left').val(minVal);
    el.find('.range__right').val(maxVal);
  }

  let leftPos =  (minVal - min) / (max - min) * 100 + '%',
      rightPos = 100 - (maxVal - min) / (max - min) * 100 + '%';

  el.find('.range__range, .range__thumb--left').css('left', leftPos);
  el.find('.range__range, .range__thumb--right').css('right', rightPos);

  if (minVal != el.find('.tooltip-from').val()){
    el.find('.tooltip-from').val(minVal);
  }
  if (maxVal != el.find('.tooltip-to').val()){
    el.find('.tooltip-to').val(maxVal);
  }
  return;
}

// Range end

$(document).on('click', '.filter__show-all', function(e){
  e.preventDefault();
  $(this).parent().find('.filter__scroll').toggleClass('active');
  $(this).parent().find('.checkbox').removeClass('hidden');
  $(this).parent().find('.filter__search input').val('');
});

jQuery.expr[':'].contains = function(a, i, m) {
  return jQuery(a).text().toUpperCase()
      .indexOf(m[3].toUpperCase()) >= 0;
};

$(document).on('keyup', '.filter__search input', function(e){
  let val = $(this).val();
  if (val!=''){
    $(this).parent().parent().parent().find('.checkbox').addClass('hidden');
    $(this).parent().parent().parent().find('.checkbox:contains(' + val + ')').removeClass('hidden');
  } else {
    $(this).parent().parent().parent().find('.checkbox').removeClass('hidden');
  }
});
