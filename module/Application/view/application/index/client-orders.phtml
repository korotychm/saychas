<?php
use Application\Resource\Resource;
$this->headTitle($this->title, 'PREPEND');
$this->inlineScript()->prependFile($this->basePath('/js/client-orders.js'));
?>
<div class="page-heading">
    <h1 class="h1">История заказов</h1>
</div>
<div class="profile-page">
  <?= $this->partial("/application/index/partials/user/user-menu", ["auth" => $this->auth]) ?>
  <div id="client-orders">
    <div v-if="preparedOrders.length" class="orders-history">
        <div v-for="order in preparedOrders" class="orders-history__item">
          <div class="orders-history__left">
            <div v-if="order.deliveryInfo.deliveries.length" class="orders-history__delivery">
              <div class="orders-history__delivery-item">
                  <h2>Доставка</h2>
                  <div class="orders-history__statuses">
                      <div class="orders-history__status orders-history__status--progress"><span>Собирается</span></div>
                      <div class="orders-history__status orders-history__status--ready">Готов</div>
                      <div class="orders-history__status orders-history__status--deliveried">Доставлен</div>
                      <div class="orders-history__status orders-history__status--canceled">Отменен</div>
                  </div>
              </div>
              <div class="orders-history__text">
                <p>{{order.deliveryInfo.deliveries.length}} {{order.deliveryUnit}}<span v-if="order.timepoint">, {{ order.dateLocaled }} с {{order.timepoint[0]}}:00 до {{order.timepoint[1]}}:00</span></p>
                <p>{{order.basketInfo.userGeoLocation.value}}</p>
              </div>
              <div class="orders-history__products">
                <a v-for="product in order.deliveryProducts" :href="'/product/' + product.id">
                  <div class="product-small-img">
                    <img :src="'<?= $this->imagePath('product').'/' ?>' + product.img" :alt="product.title" />
                  </div>
                </a>
              </div>
            </div>
            <div v-if="order.deliveryInfo.pickup.length" class="orders-history__delivery">
              <div class="orders-history__delivery-item">
                  <h2><?= Resource::THE_PICKUP ?></h2>
                  <div class="orders-history__statuses">
                      <div class="orders-history__status orders-history__status--progress"><span><?= Resource::THE_DELIVERY_PROGRESS ?> </span></div>
                      <div class="orders-history__status orders-history__status--ready"><?= Resource::THE_DELIVERY_READY?></div>
                      <div class="orders-history__status orders-history__status--deliveried"><?= Resource::THE_DELIVERY_DELIVERED ?> </div>
                      <div class="orders-history__status orders-history__status--canceled"><?= Resource::THE_DELIVERY_CANCELED ?> </div>
                  </div>
              </div>
              <div class="orders-history__text">
                <p>Из {{order.deliveryInfo.pickup.length}} {{order.pickupUnit}}</p>
              </div>
              <div class="orders-history__products">
                <a v-for="product in order.pickupProducts" :href="'/product/' + product.id">
                  <div class="product-small-img">
                    <img :src="'<?= $this->imagePath('product').'/' ?>' + product.img" :alt="product.title" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          <div class="orders-history__right">
            <div class="panel panel--cart panel--history">
                <input class="orders-history__detailed-trigger" type="checkbox" :id="'orders-detailed' + order.orderId" />
                <div class="panel__delivery">
                    <div class="panel__delivery-item"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M8.999 0.999023C13.418 0.999023 16.999 4.58102 16.999 8.99902C16.999 13.418 13.418 16.999 8.999 16.999C4.581 16.999 0.999001 13.418 0.999001 8.99902C0.999001 4.58102 4.581 0.999023 8.999 0.999023Z" stroke="currentColor" stroke-width="2" />
                        </svg>
                        <div>
                            <h2><a :href="'/user/order/' + order.orderId "><?= Resource::THE_ORDER_NUM ?> {{ order.orderId }}</a></h2>
                            <p>Создан {{ order.dateLocaled }}</p>
                        </div>
                    </div>
                </div>
                <div class="panel__zip"></div>
                <div class="panel__price">
                    <div class="panel__price-current">{{ order.total.toLocaleString() }} ₽</div>
                    <div v-if="(order.total > order.oldtotal)" class="panel__price-old">{{ order.oldtotal.toLocaleString() }} ₽</div>
                </div>
                <div class="panel__bonuses"><span>+179</span> сейбонов<div class="question">
                        <div class="question__icon">?</div>
                    </div>
                </div>
                <div class="panel__table">
                    <div class="panel__tr">
                        <div>Товары ({{order.count}})</div>
                        <div class="panel__tr-items-total">
                            <div>{{ order.productsTotal.toLocaleString() }} ₽</div>
                            <div v-if="(order.productsTotal > order.oldProductsTotal)">{{ order.oldProductsTotal.toLocaleString() }} ₽</div>
                        </div>
                    </div>
                    <div v-if="order.deliveryInfo.deliveries.length" class="panel__tr">
                        <div><b>Доставка <span v-if="order.basketInfo.ordermerge === '0'">за 1 час</span><span v-if="order.basketInfo.ordermerge === '1'">за 3 часа</span></b></div>
                        <div><span v-if="order.basketInfo.delivery_price">{{ (order.basketInfo.delivery_price / 100).toLocaleString() }} ₽</span></div>
                    </div>
                    <div v-if="order.deliveryInfo.pickup.length" class="panel__tr">
                        <div><?= Resource::THE_PICKUP ?> </div>
                        <div>0 ₽</div>
                    </div>
                </div>
                <label class="btn btn--secondary" :for="'orders-detailed' + order.orderId">Подробности заказа</label>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
<pre id="order-list" style="display: none;">
</pre>
